# NewContainment Mosquitto MQTT Broker Configuration
# Production-ready MQTT broker configuration

# Basic Listener Configuration
listener 1883
protocol mqtt

# TLS/SSL Configuration (uncomment when certificates are available)
# listener 8883
# protocol mqtt
# cafile /mosquitto/certs/ca.crt
# certfile /mosquitto/certs/server.crt
# keyfile /mosquitto/certs/server.key
# tls_version tlsv1.2
# require_certificate false

# WebSocket Configuration
listener 9000
protocol websockets

# Persistence Configuration
persistence true
persistence_file mosquitto.db
persistence_location /mosquitto/data/

# Logging Configuration
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information
log_type subscribe
log_type unsubscribe
connection_messages true
log_timestamp true
log_timestamp_format %Y-%m-%dT%H:%M:%S

# Security Configuration
allow_anonymous false

# Dynamic Security Plugin (for advanced security features)
# This allows for topic ACLs and user management via MQTT
plugin /usr/lib/mosquitto_dynamic_security.so
plugin_opt_config_file /mosquitto/config/dynamic-security.json

# System Topics (Mosquitto system information)
sys_interval 60

# Bridge Configuration (if connecting to external brokers)
# connection remote-broker
# address broker.hivemq.com:1883
# topic # both 0 local/topic/ remote/topic/

# Performance Tuning
max_connections -1
max_keepalive 65535
max_packet_size 268435455
max_inflight_messages 20
max_queued_messages 1000
message_size_limit 0

# QoS and Retained Messages
max_qos 2
max_retained_messages 1000
retained_messages_file /mosquitto/data/retained_messages.db

# Queue and Memory Configuration
queue_qos0_messages true
max_queued_bytes 0

# Client Configuration
clientid_prefixes containment_
set_tcp_nodelay true

# Topics for IoT Containment System
# Note: Actual ACLs are managed via the dynamic security plugin
# These are just examples and documentation

# Access Control Topics
# accessControl/device/command - Device management commands
# accessControl/device/response - Device responses
# accessControl/user/command - User management commands
# accessControl/user/response - User command responses
# accessControl/attendance/command - Attendance commands
# accessControl/attendance/response - Attendance responses
# accessControl/attendance/live - Real-time attendance events
# accessControl/system/status - System status updates
# accessControl/system/command - System commands
# accessControl/system/response - System responses
# IOT/Containment/Monitoring/+ - IoT sensor data
# IOT/Containment/Control/+ - Control commands
# palm/+ - Palm recognition topics
# sensor/+ - Sensor data topics

# Rate limiting (these are soft limits, not hard limits)
# message_size_limit 268435455  # 256MB max message size

# Auto-save configuration on changes
autosave_interval 300  # Save configuration every 5 minutes
autosave_on_changes true
